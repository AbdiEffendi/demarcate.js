var Showdown={extensions:{}},forEach=Showdown.forEach=function(a,b){if("function"==typeof a.forEach)a.forEach(b);else{var c,d=a.length;for(c=0;d>c;c++)b(a[c],c,a)}},stdExtName=function(a){return a.replace(/[_-]||\s/g,"").toLowerCase()};Showdown.converter=function(a){var b,c,d,e=0,f=[],g=[];if("undefind"!=typeof module&&"undefined"!=typeof exports&&"undefind"!=typeof require){var h=require("fs");if(h){var i=h.readdirSync((__dirname||".")+"/extensions").filter(function(a){return~a.indexOf(".js")}).map(function(a){return a.replace(/\.js$/,"")});Showdown.forEach(i,function(a){var b=stdExtName(a);Showdown.extensions[b]=require("./extensions/"+a)})}}if(this.makeHtml=function(a){return b={},c={},d=[],a=a.replace(/~/g,"~T"),a=a.replace(/\$/g,"~D"),a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a="\n\n"+a+"\n\n",a=M(a),a=a.replace(/^[ \t]+$/gm,""),Showdown.forEach(f,function(b){a=k(b,a)}),a=z(a),a=m(a),a=l(a),a=o(a),a=K(a),a=a.replace(/~D/g,"$$"),a=a.replace(/~T/g,"~"),Showdown.forEach(g,function(b){a=k(b,a)}),a},a&&a.extensions){var j=this;Showdown.forEach(a.extensions,function(a){if("string"==typeof a&&(a=Showdown.extensions[stdExtName(a)]),"function"!=typeof a)throw"Extension '"+a+"' could not be loaded.  It was either not found or is not a valid extension.";Showdown.forEach(a(j),function(a){a.type?"language"===a.type||"lang"===a.type?f.push(a):("output"===a.type||"html"===a.type)&&g.push(a):g.push(a)})})}var w,k=function(a,b){if(a.regex){var c=RegExp(a.regex,"g");return b.replace(c,a.replace)}return a.filter?a.filter(b):void 0},l=function(a){return a+="~0",a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|(?=~0))/gm,function(a,d,e,f,g){return d=d.toLowerCase(),b[d]=G(e),f?f+g:(g&&(c[d]=g.replace(/"/g,"&quot;")),"")}),a=a.replace(/~0/,"")},m=function(a){return a=a.replace(/\n/g,"\n\n"),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,n),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,n),a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n),a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,n),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n),a=a.replace(/\n\n/g,"\n")},n=function(a,b){var c=b;return c=c.replace(/\n\n/g,"\n"),c=c.replace(/^\n/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(d.push(c)-1)+"K\n\n"},o=function(a){a=v(a);var b=A("<hr />");return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=x(a),a=y(a),a=E(a),a=m(a),a=F(a)},p=function(a){return a=B(a),a=q(a),a=H(a),a=t(a),a=r(a),a=I(a),a=G(a),a=D(a),a=a.replace(/  +\n/g," <br />\n")},q=function(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=N(b,"\\`*_")})},r=function(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,s),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,s),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,s)},s=function(a,d,e,f,g,h,i,j){void 0==j&&(j="");var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(""==n)if(""==m&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m,void 0!=b[m])n=b[m],void 0!=c[m]&&(o=c[m]);else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}n=N(n,"*_");var p='<a href="'+n+'"';return""!=o&&(o=o.replace(/"/g,"&quot;"),o=N(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>"},t=function(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,u),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,u)},u=function(a,d,e,f,g,h,i,j){var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(o||(o=""),""==n){if(""==m&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m,void 0==b[m])return k;n=b[m],void 0!=c[m]&&(o=c[m])}l=l.replace(/"/g,"&quot;"),n=N(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=o.replace(/"/g,"&quot;"),o=N(o,"*_"),p+=' title="'+o+'"',p+=" />"},v=function(a){function b(a){return a.replace(/[^\w]/g,"").toLowerCase()}return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,c){return A('<h1 id="'+b(c)+'">'+p(c)+"</h1>")}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,c){return A('<h2 id="'+b(c)+'">'+p(c)+"</h2>")}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,c,d){var e=c.length;return A("<h"+e+' id="'+b(d)+'">'+p(d)+"</h"+e+">")})},x=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return e?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol";d=d.replace(/\n{2,}/g,"\n\n\n");var f=w(d);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n"}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",f=f.replace(/\n{2,}/g,"\n\n\n"),h=w(f);return h=e+"<"+g+">\n"+h+"</"+g+">\n"})),a=a.replace(/~0/,"")};w=function(a){return e++,a=a.replace(/\n{2,}$/,"\n"),a+="~0",a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){var f=e,g=b;return g||f.search(/\n{2,}/)>-1?f=o(L(f)):(f=x(L(f)),f=f.replace(/\n$/,""),f=p(f)),"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),e--,a};var y=function(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=C(L(d)),d=M(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>",A(d)+e}),a=a.replace(/~0/,"")},z=function(a){return a+="~0",a=a.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(a,b,c){var d=b,e=c;return e=C(e),e=M(e),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,""),e="<pre><code"+(d?' class="'+d+'"':"")+">"+e+"\n</code></pre>",A(e)}),a=a.replace(/~0/,"")},A=function(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(d.push(a)-1)+"K\n\n"},B=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=C(f),b+"<code>"+f+"</code>"})},C=function(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=N(a,"*_{}[]\\",!1)},D=function(a){return a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},E=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=o(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /gm,"~0"),c=c.replace(/~0/g,"")}),A("<blockquote>\n"+c+"\n</blockquote>")})},F=function(a){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");for(var b=a.split(/\n{2,}/g),c=[],e=b.length,f=0;e>f;f++){var g=b[f];g.search(/~K(\d+)K/g)>=0?c.push(g):g.search(/\S/)>=0&&(g=p(g),g=g.replace(/^([ \t]*)/g,"<p>"),g+="</p>",c.push(g))}e=c.length;for(var f=0;e>f;f++)for(;c[f].search(/~K(\d+)K/)>=0;){var h=d[RegExp.$1];h=h.replace(/\$/g,"$$$$"),c[f]=c[f].replace(/~K\d+K/,h)}return c.join("\n\n")},G=function(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},H=function(a){return a=a.replace(/\\(\\)/g,O),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,O)},I=function(a){return a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return J(K(b))})},J=function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+a.charCodeAt(0).toString(16)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if("@"==a)a=b[Math.floor(2*Math.random())](a);else if(":"!=a){var c=Math.random();a=c>.9?b[2](a):c>.45?b[1](a):b[0](a)}return a}),a='<a href="'+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">')},K=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})},L=function(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,"")},M=function(a){return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b){for(var d=b,e=4-d.length%4,f=0;e>f;f++)d+=" ";return d}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,"")},N=function(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=RegExp(d,"g");return a=a.replace(e,O)},O=function(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}},"undefined"!=typeof module&&(module.exports=Showdown),"function"==typeof define&&define.amd&&define("showdown",function(){return Showdown});String.prototype.repeat=function(num)
{return new Array(num+1).join(this);}
var tag_dict={'div':{editable:false,markdownable:true,prefix:'',postfix:'',post_newline:false,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'span':{editable:false,markdownable:true,prefix:'',postfix:'',post_newline:false,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'h1':{editable:true,markdownable:true,prefix:'# ',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'h2':{editable:true,markdownable:true,prefix:'## ',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'h3':{editable:true,markdownable:true,prefix:'### ',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'h4':{editable:true,markdownable:true,prefix:'#### ',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'h5':{editable:true,markdownable:true,prefix:'##### ',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'h6':{editable:true,markdownable:true,prefix:'###### ',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'li':{editable:true,markdownable:true,prefix:'- ',postfix:'\n',post_newline:false,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' > '},'ul':{editable:true,markdownable:true,prefix:'',postfix:'\n',post_newline:true,childprefix:'',allow_newline:true,force_prefix:false,selector_type:' > '},'ol':{editable:true,markdownable:true,prefix:'',postfix:'\n',post_newline:true,childprefix:'',allow_newline:true,force_prefix:false,selector_type:' > '},'blockquote':{editable:true,markdownable:true,prefix:'>',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'pre':{editable:true,markdownable:true,prefix:'    ',postfix:'\n',post_newline:true,childprefix:'    ',allow_newline:true,force_prefix:false,selector_type:' > '},'code':{editable:true,markdownable:true,prefix:' `',postfix:'` ',post_newline:false,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' > '},'a':{editable:false,markdownable:true,prefix:' [',postfix:']',post_newline:false,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' > '},'hr':{editable:true,markdownable:true,prefix:'------',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' > '},'em':{editable:false,markdownable:true,prefix:' *',postfix:'* ',post_newline:false,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' > '},'strong':{editable:false,markdownable:true,prefix:' **',postfix:'** ',post_newline:false,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' > '},'p':{editable:true,markdownable:true,prefix:'',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'table':{editable:false,markdownable:true,prefix:'',postfix:'\n',post_newline:true,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' > '},'th':{editable:true,markdownable:true,prefix:'',postfix:'',post_newline:false,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' '},'td':{editable:true,markdownable:true,prefix:'',postfix:'',post_newline:false,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' '},'br':{editable:false,markdownable:true,prefix:'    \n',postfix:'',post_newline:false,childprefix:'',allow_newline:false,force_prefix:true,selector_type:' '},'_text':{editable:false,markdownable:true,prefix:'',postfix:'',post_newline:false,childprefix:'',allow_newline:false,force_prefix:false,selector_type:' '},};function modifyHtml(str){ var strippedText=$("<div/>").html(str).text(); var convertor=new Showdown.converter();var op=convertor.makeHtml(strippedText);return op;}
function demarkdown_table(elem){ var maxColLen=[];var rowLen=0;var cells=[];var op="";var headerRow=true;var col=0;var row=0; elem.find("tr").each(function(){cells[row]=[];col=0; $(this).children().each(function(){ var contents=$(this).text();var contentLen=contents.length; if(maxColLen.length<=col){maxColLen.push(contentLen);}else{if(contentLen>maxColLen[col]){maxColLen[col]=contentLen;}} 
cells[row][col]=demarkdown($(this));col++;});row++;}); for(var r=0;r<maxColLen.length;r++){rowLen+=maxColLen[r]+1;} 
for(var r=0;r<cells.length;r++){ var row=cells[r];for(var c=0;c<row.length;c++){var cellLen=row[c].length;var padding=maxColLen[c]-cellLen;op+=row[c]+" ".repeat(padding)+"|";} 
if(headerRow){op+="\n";for(var i=0;i<maxColLen.length;i++){op+="-".repeat(maxColLen[i])+"|";}
headerRow=false;}
op+="\n";}
return op+"\n\n";}
function demarkdown(elem,ignore_extras,child_prefix){ var node=elem.get(0);var node_type=node.nodeType;var tag_name=node_type==3?'_text':node.tagName.toLowerCase();var result=""; if(elem.hasClass("demarcate_temporary"))return result; if(!(tag_name in tag_dict))return result; if((!tag_dict[tag_name].markdownable)&&node_type!=3){return result;}
if(tag_name=='div'&&elem.hasClass("toc")){return"\n[TOC]\n\n";}else if(tag_name=='table'){return demarkdown_table(elem);} 
if(!ignore_extras||tag_dict[tag_name].force_prefix){result+=tag_dict[tag_name].prefix;} 
if(node_type==3){if($.trim(node.nodeValue)==""){return"";}
result+=$.trim(node.nodeValue);} 
result+=tag_dict[tag_name].childprefix;$.each(elem.contents(),function(index,value){result+=demarkdown($(value),ignore_extras,"");}); if(!ignore_extras||tag_dict[tag_name].force_prefix){result+=tag_dict[tag_name].postfix;} 
if(tag_dict[tag_name].post_newline){result+='\n';} 
if(tag_name=='a'){result=" "+result+"("+elem.attr('href')+") ";} 
return result;}
function generate_toolbar(){var toolbar=$("<div />",{id:'demarcate_toolbar'});toolbar.append($("<a />",{id:'demarcate_h1',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h2',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h3',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h4',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h5',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h6',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_p',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_code',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_pre',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_blockquote',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_ul',class:'demarcate_style',href:"#"}));toolbar.append($("<p/>"));toolbar.append($("<a />",{id:'demarcate_up',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_down',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_help',class:'demarcate_style',href:"#"}));toolbar.append($("<p/>"));toolbar.append($("<a />",{id:'demarcate_cancel',href:"#"}));toolbar.append($("<a />",{id:'demarcate_save',href:"#"}));return toolbar;}
function toolbar_set_active(){var tag_name=""; if(current_demarcate_element==null){return;}else{tag_name=current_demarcate_element.get(0).tagName.toLowerCase();} 
$(".demarcate_style").removeClass("active"); $("#demarcate_"+tag_name).addClass("active");}
function display_editor(elem){ if(current_demarcate_editor!=null){return;}
elem=$(elem);var tag_name=elem.get(0).tagName.toLowerCase(); if(tag_name in tag_dict){ var md=demarkdown(elem,true,"");var ed=$("<textarea />",{id:'demarcate'}).css("font",elem.css("font")).css("outline","none").css("border",elem.css("border")).css("margin",elem.css("margin")).css("textAlign",elem.css("textAlign"));var tb=generate_toolbar();elem.after(tb).slideDown();elem.after(ed).slideDown();elem.addClass("demarcate_hide"); current_demarcate_element=elem;current_demarcate_editor=ed; toolbar_set_active(); ed.val($.trim(md)); if(typeof elem.autosize!=undefined){ed.autosize({'append':'\n'});}
ed.focus(); $("html, body").scrollTop(current_demarcate_editor.offset().top);}}
function hide_editor(e){e.preventDefault(); $("div#demarcate_toolbar").remove();current_demarcate_editor.remove();current_demarcate_editor=null; if(current_demarcate_element.html()===""&&current_demarcate_element.get(0).tagName!="HR"){current_demarcate_element.remove();}else{current_demarcate_element.removeClass("demarcate_hide");}
current_demarcate_element=null;$(".demarcate_temporary").remove();}
function demarcate_click_elsewhere_save(e){if(current_demarcate_editor==null)return;var tb=$("#demarcate_toolbar");if(!current_demarcate_editor.is(e.target)&&!tb.is(e.target)&&tb.has(e.target).length===0){$("#demarcate_save").click();}}
function replace_tag(id){var new_elem=$("<"+id+"/>");current_demarcate_element.after(new_elem);current_demarcate_element.remove();current_demarcate_element=new_elem; $("a#demarcate_cancel").fadeOut('fast',function(){this.remove();}); current_demarcate_editor.css("font",current_demarcate_element.css("font")).css("border",current_demarcate_element.css("border")).css("margin",current_demarcate_element.css("margin")).css("textAlign",current_demarcate_element.css("textAlign")); toolbar_set_active()
current_demarcate_editor.focus();}
function save_and_new_editor_area(){ var tag_name=current_demarcate_element.get(0).tagName.toLowerCase();var new_elem=null; if(tag_name=="td"||tag_name=="th"){new_elem=get_next_table_cell(current_demarcate_element);}else{new_elem=$("<"+tag_name+"/>");new_elem.insertAfter(current_demarcate_element);} 
$("#demarcate_save").click(); if(tag_name!="td"&&tag_name!="th"){new_elem.addClass("demarcate_temporary");}
if(new_elem!==null){new_elem.click();}}
function get_next_table_cell(elem){var next_td=elem.nextAll("td, th");if(next_td.length==0){var next_tr=elem.parent("tr").nextAll("tr");if(next_tr.length==0){return null;}else{return next_tr.find("th, td").first();}}
return next_td}
function enable_demarcate_toolbar_handlers(){ $(document).on('keydown','#demarcate',function(e){if(e.keyCode==13){ e.preventDefault();if(e.shiftKey){ $("#demarcate_save").click();}else if(e.ctrlKey){ save_and_new_editor_area();}else{ if(tag_dict[current_demarcate_element.get(0).tagName.toLowerCase()].allow_newline){current_demarcate_editor.insertAtCaret("\n");}else{save_and_new_editor_area();}}}else if(e.keyCode==32){ if(e.ctrlKey){e.preventDefault();var next_style=$("div#demarcate_toolbar a.active").next().filter(".demarcate_style");if(next_style.length!=0){ next_style.click();}else{$("div#demarcate_toolbar a.demarcate_style").first().click();}}}else if(e.keyCode==27){ e.preventDefault();$("#demarcate_cancel").click();}else if(e.keyCode==9){ e.preventDefault();current_demarcate_editor.insertAtCaret("    ");}else if(e.keyCode==40){ if(e.altKey){var next=$("#demarcate_toolbar").next(".demarcate_editable");if(next.length>0){$("#demarcate_save").click();next.first().click();}}}else if(e.keyCode==38){ if(e.altKey){var previous=current_demarcate_element.prev(".demarcate_editable");if(previous.length>0){$("#demarcate_save").click();previous.first().click();}}}}); $(document).bind('mousedown',demarcate_click_elsewhere_save); $(document).on('click','#demarcate_cancel',function(e){hide_editor(e);$(document).trigger('demarcate_editor_closed',[current_demarcate_element]);}); $(document).on('click','#demarcate_save',function(e){ var tag_name=current_demarcate_element.get(0).tagName.toLowerCase();var curr_value=current_demarcate_editor.val();if(curr_value!=""){if(tag_name!="hr"){curr_value=tag_dict[tag_name].prefix+tag_dict[tag_name].childprefix+
curr_value+tag_dict[tag_name].postfix;}}
var new_elem=$(modifyHtml(curr_value)); if(tag_name=="th"||tag_name=="td"){current_demarcate_element.html(new_elem.html());}else{new_elem.insertBefore(current_demarcate_element);current_demarcate_element.remove();current_demarcate_element=new_elem;} 
hide_editor(e)
$(document).trigger('demarcate_editor_closed',[current_demarcate_element]);}); $(document).on('mouseover','.demarcate_style',function(e){var bg_pos=$(e.target).css('backgroundPosition').split(' ');$(e.target).css('backgroundPosition',bg_pos[0]+" "+(parseInt(bg_pos[1])-72)+"px");}); $(document).on('mouseout','.demarcate_style',function(e){var bg_pos=$(e.target).css('backgroundPosition').split(' ');$(e.target).css('backgroundPosition',bg_pos[0]+" "+(parseInt(bg_pos[1])+72)+"px");}); $(document).on('click','.demarcate_style',function(e){e.preventDefault();var target_tag=$(this).attr('id').replace("demarcate_",""); if(target_tag in tag_dict){ var current_tag=current_demarcate_element.get(0).tagName.toLowerCase();var parent_tag=current_demarcate_element.parent().get(0).tagName.toLowerCase();if(current_tag=='li'&&target_tag!='ul'){ par=current_demarcate_element.parent();current_demarcate_element.detach().insertAfter(par);replace_tag(target_tag);}else if(current_tag!='li'&&target_tag=='ul'){var list=$("<"+target_tag+"/>");list.insertBefore(current_demarcate_element);current_demarcate_element.appendTo(list);replace_tag('li');}else{replace_tag(target_tag);}}else{if(target_tag=='help'){alert("SHIFT+ENTER - save your changes\nESCAPE - cancel your changes\n"+"CTRL+ENTER - save your changes, insert a new section\n"+"ENTER - save your changes (or add new line in a code block)\n"+"ALT+UP/DOWN - navigate up and down through elemnts");}}}); $(document).on('click','#demarcate_down',function(e){e.preventDefault();var next=$("#demarcate_toolbar").next(".demarcate_editable");if(next.length>0){next.insertBefore(current_demarcate_element);}
current_demarcate_editor.focus();}); $(document).on('click','#demarcate_up',function(e){e.preventDefault();var previous=current_demarcate_element.prev(".demarcate_editable");if(previous.length>0){previous.insertAfter($("#demarcate_toolbar"));}
current_demarcate_editor.focus();});};(function($){$.fn.demarcate=function(){result=demarkdown(this,false,"");$(document).trigger("demarcation_complete",[result]);return result;};})(jQuery);(function($){$.fn.enable_demarcate=function(){ window.demarcate_dom_root=$(this);window.current_demarcate_editor=null;window.current_demarcate_element=null; for(var tag_name in tag_dict){if(tag_dict[tag_name].editable){live_selector="#"+this.attr('id')+
tag_dict[tag_name].selector_type+tag_name;$(document).on('click',live_selector,function(e){ if($("#demarcate_toolbar").has(e.target).length>0||$("#demarcate_toolbar").is(e.target)||$(this).attr('id')==='demarcate'){return;} 
display_editor(this);});$(live_selector).addClass("demarcate_editable");$(document).on('DOMNodeInserted',live_selector,function(e){$(e.target).addClass("demarcate_editable");});}}
enable_demarcate_toolbar_handlers(); if(demarcate_dom_root.is(":empty")||$.trim(demarcate_dom_root.html())==""){demarcate_dom_root.append($('<p />',{class:'demarcate_temporary',text:'Click me to start editing'}));}};})(jQuery);(function($){$.fn.insertAtCaret=function(my_value){ var orig_val=this.val().replace(/\r\n/g,"\n");var start_repl=this.get(0).selectionStart;var end_repl=this.get(0).selectionEnd; var new_val=orig_val.substring(0,start_repl)+my_value+orig_val.substring(end_repl); this.val(new_val.replace(/\n/g,"\r\n"));}})(jQuery);